<!DOCTYPE html>
<html>
<head>
    <title>SIGRA - Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f4f6f9; }
        
        /* [NOVO] Estilo da Barra de Usu√°rio no topo */
        .user-bar { background: #343a40; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-radius: 4px; }
        .user-info { font-size: 1.1em; }
        .btn-logout { color: #ffc107; text-decoration: none; font-weight: bold; font-size: 0.9em; border: 1px solid #ffc107; padding: 5px 10px; border-radius: 4px; }
        .btn-logout:hover { background: #ffc107; color: #343a40; }

        /* Estilos dos KPIs (Mantidos do seu c√≥digo) */
        .kpi-container { display: flex; gap: 20px; margin-bottom: 20px; }
        .kpi-card { flex: 1; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; border-bottom: 4px solid #ccc; }
        .kpi-number { font-size: 2em; font-weight: bold; color: #333; }
        .kpi-label { color: #666; text-transform: uppercase; font-size: 0.8em; }
        
        /* Estilos Gerais */
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border-bottom: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #343a40; color: white; }
        .status-manutencao { color: #dc3545; font-weight: bold; }
        
        /* Bot√µes */
        .btn { padding: 10px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; display: inline-block; margin-right: 10px;}
        .search-box { width: 100%; padding: 10px; margin-top: 10px; border: 1px solid #ddd; border-radius: 4px; }
        
        /* Formul√°rio de exclus√£o alinhado */
        .form-delete { display: inline; }
        .btn-delete { background-color: #dc3545; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .btn-hist { background-color: #17a2b8; color: white; padding: 6px 10px; text-decoration: none; border-radius: 4px; font-size: 0.9em; margin-right: 5px; }
    </style>
    <script>
        function confirmarExclusao(nome) {
            return confirm(`ATEN√á√ÉO: Voc√™ tem certeza que deseja excluir o item ${nome}? Essa a√ß√£o n√£o pode ser desfeita.`);
        }
    </script>
</head>
<body>
    
    <div class="user-bar">
        <span class="user-info">üë§ Ol√°, <strong><%= usuario.nome %></strong> (<%= usuario.cargo %>)</span>
        <a href="/logout" class="btn-logout">Sair üö™</a>
    </div>

    <h1>SIGRA - Gest√£o de Rastreadores</h1>
    
    <div class="kpi-container">
        <div class="kpi-card" style="border-color: #007bff;">
            <div class="kpi-number"><%= kpis.total %></div>
            <div class="kpi-label">Total Geral</div>
        </div>
        <div class="kpi-card" style="border-color: #28a745;">
            <div class="kpi-number"><%= kpis.estoque %></div>
            <div class="kpi-label">Em Estoque</div>
        </div>
        <div class="kpi-card" style="border-color: #17a2b8;">
            <div class="kpi-number"><%= kpis.cliente %></div>
            <div class="kpi-label">Em Clientes</div>
        </div>
        <div class="kpi-card" style="border-color: #dc3545;">
            <div class="kpi-number"><%= kpis.manutencao %></div>
            <div class="kpi-label">Em Manuten√ß√£o</div>
        </div>
    </div>

    <div style="margin-bottom: 20px; background: #e9ecef; padding: 15px; border-radius: 8px; display: flex; align-items: center;">
        <span style="font-weight: bold; margin-right: 15px;">A√ß√µes R√°pidas:</span>
        
        <% if (usuario.cargo === 'Administrador') { %>
            <a href="/rastreador/novo" class="btn" style="background: #28a745;">‚ûï Novo Rastreador</a>
            <a href="/clientes" class="btn" style="background: #6c757d;">üë• Clientes</a>
        <% } %>

        <% if (usuario.cargo === 'Administrador' || usuario.cargo === 'Operador') { %>
            <a href="/movimentacao" class="btn">üöö Movimenta√ß√£o</a>
        <% } %>

        <% if (usuario.cargo === 'Administrador' || usuario.cargo === 'Tecnico') { %>
            <a href="/manutencao" class="btn" style="background: #ffc107; color: black;">üõ†Ô∏è Manuten√ß√£o</a>
        <% } %>
    </div>

    <div class="card">
        <h3>üîç Consulta de Estoque</h3>
        <form action="/" method="GET">
            <input type="text" name="busca" class="search-box" placeholder="Pesquisar por IMEI ou Modelo..." value="<%= termoBusca || '' %>">
        </form>

        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>IMEI</th>
                    <th>Modelo/Fabricante</th>
                    <th>Operadora</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                <% rastreadores.forEach(r => { %>
                    <tr>
                        <td><%= r.id %></td>
                        <td><%= r.imei %></td>
                        <td><%= r.modelo %> <small style="color:#666">(<%= r.fabricante %>)</small></td>
                        <td><%= r.operadora %></td>
                        <td style="font-weight: bold;" class="<%= r.status === 'Em Manuten√ß√£o' ? 'status-manutencao' : '' %>"><%= r.status %></td>
                        <td>
                            <a href="/rastreador/<%= r.id %>" class="btn-hist">üëÅÔ∏è Ver</a>
                            
                            <% if (usuario.cargo === 'Administrador') { %>
                                <form action="/rastreador/<%= r.id %>/deletar" method="POST" class="form-delete" onsubmit="return confirmarExclusao('<%= r.imei %>')">
                                    <button type="submit" class="btn-delete">üóëÔ∏è Excluir</button>
                                </form>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</body>
</html>